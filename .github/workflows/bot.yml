name: ğŸ›¡ï¸ Iran-USA-Israel War Bot v14

on:
  schedule:
    - cron: '*/5 * * * *'    # Ù‡Ø± Ûµ Ø¯Ù‚ÛŒÙ‚Ù‡
  workflow_dispatch:

# Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§Ø¬Ø±Ø§ÛŒ Ù‡Ù…Ø²Ù…Ø§Ù† Ø¯Ùˆ Ù†Ø³Ø®Ù‡ Ø§Ø² Ø±Ø¨Ø§Øª Ùˆ Ø®Ø±Ø§Ø¨ÛŒ Ø¯ÛŒØªØ§Ø¨ÛŒØ³â€ŒÙ‡Ø§ÛŒ JSON
concurrency:
  group: bot-runner
  cancel-in-progress: false

jobs:
  run-bot:
    runs-on: ubuntu-latest
    timeout-minutes: 6       # Ø²Ù…Ø§Ù† Ø±Ø§ Ú©Ù…ÛŒ Ø¨ÛŒØ´ØªØ± Ú©Ø±Ø¯ÛŒÙ… ØªØ§ Ù¾Ø±Ø¯Ø§Ø²Ø´â€ŒÙ‡Ø§ÛŒ Gemini Ù‚Ø·Ø¹ Ù†Ø´ÙˆØ¯
    permissions:
      contents: write

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 1

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'

      # Ø¯Ø§Ù†Ù„ÙˆØ¯ ÛŒÚ© ÙÙˆÙ†Øª Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ ÙØ§Ø±Ø³ÛŒ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ ØªØµÙˆÛŒØ±ÛŒ
      - name: Download Persian Font
        run: wget -q -O Vazirmatn.ttf https://github.com/rastikerdar/vazirmatn/raw/master/fonts/ttf/Vazirmatn-Bold.ttf

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Run War Bot
        env:
          BOT_TOKEN:      ${{ secrets.BOT_TOKEN }}
          CHANNEL_ID:     ${{ secrets.CHANNEL_ID }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: python bot.py

      - name: Commit and Push state files
        if: always()
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "41898282+github-actions[bot]@users.noreply.github.com"
          
          # Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ØªÙ…Ø§Ù… ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ JSON Ú©Ù‡ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ø¯ÛŒØªØ§Ø¨ÛŒØ³/Ø§Ø³ØªÛŒØª Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
          git add *.json 2>/dev/null || true
          
          # Ø§Ú¯Ø± ØªØºÛŒÛŒØ±ÛŒ Ø¨ÙˆØ¯ØŒ Ú©Ø§Ù…ÛŒØª Ú©Ù†. Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² pull --rebase Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø®Ø·Ø§ÛŒ Conflict
          git diff --staged --quiet || \
            (git commit -m "â™»ï¸ state update [skip ci]" && \
             git pull --rebase origin main && \
             git push)
