name: ðŸ›¡ï¸ Military News Bot

on:
  schedule:
    # Ù‡Ø± Û± Ø³Ø§Ø¹Øª â€” Ù…Ù†Ø§Ø³Ø¨ Ø±ÛŒÙ¾Ùˆ Private (Ø²ÛŒØ± Û²Û°Û°Û° Ø¯Ù‚ÛŒÙ‚Ù‡ Ø±Ø§ÛŒÚ¯Ø§Ù†/Ù…Ø§Ù‡)
    # Ø¨Ø±Ø§ÛŒ Ù‡Ø± Û³Û° Ø¯Ù‚ÛŒÙ‚Ù‡: '*/30 * * * *'  (Ù†ÛŒØ§Ø² Ø¨Ù‡ GitHub Pro - $4/Ù…Ø§Ù‡)
    - cron: '0 * * * *'
  workflow_dispatch:   # Ø§Ø¬Ø±Ø§ÛŒ Ø¯Ø³ØªÛŒ Ø§Ø² Ù¾Ù†Ù„ GitHub
    inputs:
      send_startup:
        description: 'Ù¾ÛŒØ§Ù… Ø´Ø±ÙˆØ¹ Ø¨ÙØ±Ø³ØªÙ‡ØŸ'
        required: false
        default: 'false'

jobs:
  run-bot:
    name: Fetch & Send News
    runs-on: ubuntu-latest
    timeout-minutes: 8    # Ø§Ú¯Ù‡ Ú¯ÛŒØ± Ú©Ø±Ø¯ Ø¨Ø¹Ø¯ Û¸ Ø¯Ù‚ÛŒÙ‚Ù‡ Ú©Ù†Ø³Ù„ Ø´Ù‡

    permissions:
      contents: write     # Ø¨Ø±Ø§ÛŒ commit Ú©Ø±Ø¯Ù† seen.json

    steps:
      # â”€â”€â”€ Û±. Ø¯Ø§Ù†Ù„ÙˆØ¯ Ú©Ø¯ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 1

      # â”€â”€â”€ Û². Ù¾Ø§ÛŒØªÙˆÙ† â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'

      # â”€â”€â”€ Û³. Ù†ØµØ¨ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Install dependencies
        run: |
          pip install --quiet \
            feedparser \
            httpx \
            beautifulsoup4 \
            pytz \
            lxml

      # â”€â”€â”€ Û´. Ø§Ø¬Ø±Ø§ÛŒ Ø¨Ø§Øª â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Run bot
        env:
          BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
          CHANNEL_ID: ${{ secrets.CHANNEL_ID }}
        run: python bot.py

      # â”€â”€â”€ Ûµ. Ø°Ø®ÛŒØ±Ù‡ seen.json Ø¯Ø± Ø±ÛŒÙ¾Ùˆ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Save seen articles
        if: always()    # Ø­ØªÛŒ Ø§Ú¯Ù‡ Ø®Ø·Ø§ Ø¯Ø§Ø¯ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†
        run: |
          git config user.name  "Military Bot"
          git config user.email "bot@noreply.github.com"
          git add seen.json 2>/dev/null || true
          git diff --staged --quiet || git commit -m "â™»ï¸ update seen [skip ci]"
          git push 2>/dev/null || true
